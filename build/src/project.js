window.__require=function t(i,n,e){function o(a,r){if(!n[a]){if(!i[a]){var h=a.split("/");if(h=h[h.length-1],!i[h]){var c="function"==typeof __require&&__require;if(!r&&c)return c(h,!0);if(s)return s(h,!0);throw new Error("Cannot find module '"+a+"'")}}var u=n[a]={exports:{}};i[a][0].call(u.exports,function(t){return o(i[a][1][t]||t)},u,u.exports,t,i,n,e)}return n[a].exports}for(var s="function"==typeof __require&&__require,a=0;a<e.length;a++)o(e[a]);return o}({anim:[function(t,i,n){"use strict";cc._RF.push(i,"799a4xLBHRLq7Kj9a2fTp/y","anim");i.exports=function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},e=i.getComponent(cc.Sprite),o=i.addComponent(cc.Animation),s=0;return t.forEach(function(i){cc.loader.loadResDir(i,cc.SpriteFrame,function(a,r){e.spriteFrame=r[0];var h=cc.AnimationClip.createWithSpriteFrames(r,8);h.name=i,h.wrapMode=cc.WrapMode.Loop,o.addClip(h),++s===t.length&&n()})}),o},cc._RF.pop()},{}],"frame-action":[function(t,i,n){"use strict";cc._RF.push(i,"75482+WGJtICoDc6STdwLjk","frame-action");var e=function(t){this.opts=t,this.node=t.parent,this.onPlay=t.onPlay,this.onFinished=t.onFinished,this.createAction(t)};e.prototype={createAction:function(t){var i=this,n=t.play,e=t.action,o=t.view,s=t.parent,a=new cc.Node;a.name="actions",a.parent=s;var r=a.addComponent(cc.Sprite),h=a.addComponent(cc.Animation);cc.loader.loadResDir(n+"/"+e+"/"+o,cc.SpriteFrame,function(t,n){var e=n;r.spriteFrame=e[0];var o=cc.AnimationClip.createWithSpriteFrames(e,8);o.name="anim_action",o.wrapMode=cc.WrapMode.Normal,h.addClip(o),h.play("anim_action"),h.on("play",i._onPlay,i),h.on("finished",i._onFinished,i)}),this.actionsNode=a},removeAniNode:function(){this.actionsNode.removeFromParent()},_onPlay:function(){console.log("_play"),this.onPlay&&this.onPlay()},_onFinished:function(){console.log("_onFinished"),this.removeAniNode(),this.onFinished&&this.onFinished()}},i.exports=e,cc._RF.pop()},{}],game:[function(t,i,n){"use strict";function e(t){if(Array.isArray(t)){for(var i=0,n=Array(t.length);i<t.length;i++)n[i]=t[i];return n}return Array.from(t)}cc._RF.push(i,"c230fsafcFJlJ2OmgyMYqBy","game");var o=cc.Node.EventType,s=o.TOUCH_START,a=o.TOUCH_END;cc.Class({extends:cc.Component,properties:{ground:{default:null,type:cc.Node},hero:{default:null,type:cc.Node},punkPrefab:{default:null,type:cc.Prefab},scoreDisplay:{default:null,type:cc.Label},heroPHDisplay:{default:null,type:cc.Node},minX:0,maxX:0,minY:0,maxY:0,punkNodeList:[],score:0,heroPH:10},onLoad:function(){var t=this;this.heroPH=10,this.updateHeroPH(),this.heroNode=this.node.getChildByName("hero"),this.hero=this.heroNode.getComponent("hero"),this.bindCtrl(),this.getXYSpan(),this.newPunk(),setTimeout(function(){return t.newPunk()},2e3),setTimeout(function(){return t.newPunk()},3e3),setTimeout(function(){return t.newPunk()},4e3),setTimeout(function(){return t.newPunk()},5e3)},bindCtrl:function(){var t=this,i=this.node.getChildByName("ctrl-fist"),n=this.node.getChildByName("ctrl-kick"),e=this.node.getChildByName("ctrl-up"),o=this.node.getChildByName("ctrl-down"),r=this.node.getChildByName("ctrl-right"),h=this.node.getChildByName("ctrl-left");i.zIndex=20,n.zIndex=20,e.zIndex=20,o.zIndex=20,r.zIndex=20,h.zIndex=20,i.on(s,function(){return t.hero.fistDown()}),i.on(a,function(){return t.hero.fistUp()}),n.on(s,function(){return t.hero.kickDown()}),n.on(a,function(){return t.hero.kickUp()}),e.on(s,function(){return t.hero.directDown("up")}),e.on(a,function(){return t.hero.directUp()}),o.on(s,function(){return t.hero.directDown("down")}),o.on(a,function(){return t.hero.directUp()}),h.on(s,function(){return t.hero.directDown("left")}),h.on(a,function(){return t.hero.directUp()}),r.on(s,function(){return t.hero.directDown("right")}),r.on(a,function(){return t.hero.directUp()})},getXYSpan:function(){var t=this.ground,i=t.height,n=t.y;this.minX=-cc.winSize.width/2,this.maxX=-this.minX,this.minY=n-i,this.maxY=n},newPunk:function(){var t=cc.instantiate(this.punkPrefab),i=this.getPunkPos();this.node.addChild(t),t.setPosition.apply(t,e(i)),this.punkNodeList.push(t)},getPunkPos:function(){var t=Math.random();return[t>.5?this.minX:this.maxX,(this.maxY-this.minY)*t+this.minY]},heroAttack:function(){this.punkNodeList.forEach(function(t){t.getComponent("punk").getHit()})},punkFall:function(t){var i=this,n=this.punkNodeList.indexOf(t);-1!==n&&(this.punkNodeList.splice(n,1),setTimeout(function(){i.newPunk(),i.score++,i.scoreDisplay.string="score: "+i.score},1500))},punkAttack:function(){this.hero.falling||(this.hero.hurt(),this.heroPH--,this.updateHeroPH(),this.heroPH<=0&&this.hero.fall())},updateHeroPH:function(){this.heroPH<0&&(this.heroPH=0),this.heroPHDisplay.width=10*this.heroPH}}),cc._RF.pop()},{}],hero:[function(t,i,n){"use strict";cc._RF.push(i,"02842c1oZxJ3bu715Qv0lMl","hero");var e=t("./utils/anim.js");cc.Class({extends:cc.Component,properties:{parent:null,move:"",walking:!1,fisting:!1,kicking:!1,hurting:!1,falling:!1,anim:null,face:"r",game:null,speedX:140,speedY:70,attackTimer:0},onLoad:function(){this.game=this.node.parent.getComponent("game"),this.node.zIndex=10,this.loadAnim(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},update:function(t){this.heroMove(t)},loadAnim:function(){var t=this;this.anim=e(["hero-fist","hero-kick","hero-walk","hero-hurt","hero-fall"],this.node,function(){t.stand(),t.walking=!1,t.attackTimer=setInterval(function(){t.game.heroAttack(t,t.node)},500)})},heroMove:function(t){switch(this.move){case"":break;case"right":if(this.face="r",this.node.rotationY=0,this.node.x>=this.game.maxX)return;if(this.fisting||this.kicking)return;this.node.x+=this.speedX*t;break;case"left":if(this.face="l",this.node.rotationY=180,this.node.x<=this.game.minX)return;if(this.fisting||this.kicking)return;this.node.x-=this.speedX*t;break;case"up":if(this.node.y>=this.game.maxY)return;if(this.fisting||this.kicking)return;this.node.y+=this.speedY*t;break;case"down":if(this.node.y<=this.game.minY)return;if(this.fisting||this.kicking)return;this.node.y-=this.speedY*t}},onKeyDown:function(){switch(event.keyCode){case cc.macro.KEY.a:this.directDown("left");break;case cc.macro.KEY.d:this.directDown("right");break;case cc.macro.KEY.s:this.directDown("down");break;case cc.macro.KEY.w:this.directDown("up");break;case cc.macro.KEY.j:this.kickDown();break;case cc.macro.KEY.k:this.fistDown()}},onKeyUp:function(){switch(event.keyCode){case cc.macro.KEY.a:case cc.macro.KEY.d:case cc.macro.KEY.s:case cc.macro.KEY.w:this.directUp();break;case cc.macro.KEY.j:this.kickUp();break;case cc.macro.KEY.k:this.fistUp()}},directDown:function(t){this.hurting||this.falling||(this.move=t,this.walk())},directUp:function(){this.move="",this.walking=!1,this.anim.stop("hero-walk")},kickDown:function(){this.hurting||this.falling||this.kick()},kickUp:function(){this.kicking=!1,this.anim.stop("hero-kick"),this.stand()},fistDown:function(){this.hurting||this.falling||this.fist()},fistUp:function(){this.fisting=!1,this.anim.stop("hero-fist"),this.stand()},walk:function(){this.walking||this.fisting||this.kicking||(this.anim.play("hero-walk"),this.walking=!0)},kick:function(){this.kicking||(this.kicking=!0,this.anim.play("hero-kick"))},fist:function(){this.fisting||(this.fisting=!0,this.anim.play("hero-fist"))},stand:function(){var t=this;this.falling||(this.anim.play("hero-walk"),setTimeout(function(){t.anim.stop("hero-walk")},100))},hurt:function(){var t=this;this.falling||(this.hurting=!0,this.anim.play("hero-hurt"),setTimeout(function(){t.anim.pause("hero-hurt")},200),this.hurtTimer&&clearTimeout(this.hurtTimer),this.hurtTimer=setTimeout(function(){t.stand(),t.hurting=!1},500))},fall:function(){this.hurtTimer&&clearTimeout(this.hurtTimer),this.anim.play("hero-fall"),this.falling=!0}}),cc._RF.pop()},{"./utils/anim.js":"anim"}],punk:[function(t,i,n){"use strict";var e;function o(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}cc._RF.push(i,"eaccbBWfHJG+YIWMvRWP1i4","punk");var s=t("./utils/anim.js");cc.Class({extends:cc.Component,properties:(e={ready:!1,radius:50,face:"r",head:"u",anim:null,speedX:50,speedY:25,heroNode:null,hero:null},o(e,"anim",null),o(e,"hurtTimer",0),o(e,"attackTimer",0),o(e,"standing",!1),o(e,"walking",!1),o(e,"hurting",!1),o(e,"falling",!1),o(e,"ph",5),e),onLoad:function(){this.speedX=50*Math.random()+20,this.game=this.node.parent.getComponent("game"),this.heroNode=this.node.parent.getChildByName("hero"),this.hero=this.heroNode.getComponent("hero"),this.loadAnim()},update:function(t){this.approachHero(t)},loadAnim:function(){var t=this;this.anim=s(["punk-pant","punk-hurt","punk-fall","punk-walk","punk-fist","punk-kick"],this.node,function(){t.stand(),t.ready=!0,t.attackTimer=setInterval(function(){t.attack()},2e3)})},getDist:function(){var t=this.node.x-this.heroNode.x,i=Math.abs(t),n=this.node.y-this.heroNode.y;return{deltaX:t,gapX:i,deltaY:n,gapY:Math.abs(n)}},approachHero:function(t){if(this.ready){var i=this.getDist(),n=i.deltaX,e=i.gapX,o=i.deltaY,s=i.gapY;this.head=o<0?"u":"d",this.node.zIndex="u"===this.head?this.heroNode.zIndex+1:this.heroNode.zIndex-1,this.hurting||this.falling||this.attacking||(this.face=n<0?"r":"l",this.node.rotationY="r"===this.face?0:180,this.walkingX(t,e),this.walkingY(t,e,s),e<50&&s<10?this.stand():this.walk())}},walkingX:function(t,i){if(!(i<50)){var n=i<this.speedX?i:this.speedX;"r"===this.face?this.node.x+=n*t:this.node.x-=n*t}},walkingY:function(t,i,n){if(!(i>150)){var e=n<this.speedY?n:this.speedY;"u"===this.head?this.node.y+=e*t:this.node.y-=e*t}},walk:function(){this.walking||(this.anim.play("punk-walk"),this.walking=!0)},stand:function(){var t=this;this.falling||this.attacking||(this.anim.play("punk-walk"),setTimeout(function(){t.anim.stop("punk-walk"),t.standing=!0,t.walking=!1},100))},attack:function(){var t=this;if(!this.hero.falling){var i=this.getDist(),n=i.gapX,e=i.gapY;if(!(n>50||e>10)){var o=Math.random()>.5?"punk-fist":"punk-kick";this.hurting||this.walking||this.falling||(this.attacking=!0,setTimeout(function(){t.hurting||t.walking||t.falling||(t.anim.play(o),t.game.punkAttack(),setTimeout(function(){t.attacking=!1,t.anim.stop(o),t.stand()},600))},900))}}},getHit:function(){var t=this.getDist(),i=t.deltaX,n=t.gapX;t.gapY>20||n>60||this.falling||(this.hero.fisting||this.hero.kicking)&&("r"===this.hero.face&&i<0||"l"===this.hero.face&&i>0||this.hurt())},hurt:function(){var t=this;this.hurting=!0,this.anim.play("punk-hurt"),setTimeout(function(){t.anim.stop("punk-hurt")},200),this.ph--,this.ph<=0&&this.fall(),this.hurtTimer&&clearTimeout(this.hurtTimer),this.hurtTimer=setTimeout(function(){t.stand(),t.ph++,t.hurting=!1},2e3)},fall:function(){var t=this;this.hurtTimer&&clearTimeout(this.hurtTimer),this.anim.play("punk-fall"),this.game.punkFall(this.node),clearInterval(this.attackTimer),setTimeout(function(){t.node.destroy()},2e3),this.falling=!0}}),cc._RF.pop()},{"./utils/anim.js":"anim"}]},{},["game","hero","punk","anim","frame-action"]);