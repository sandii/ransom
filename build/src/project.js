window.__require=function t(i,n,e){function s(o,h){if(!n[o]){if(!i[o]){var r=o.split("/");if(r=r[r.length-1],!i[r]){var c="function"==typeof __require&&__require;if(!h&&c)return c(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+o+"'")}}var u=n[o]={exports:{}};i[o][0].call(u.exports,function(t){return s(i[o][1][t]||t)},u,u.exports,t,i,n,e)}return n[o].exports}for(var a="function"==typeof __require&&__require,o=0;o<e.length;o++)s(e[o]);return s}({anim:[function(t,i,n){"use strict";cc._RF.push(i,"799a4xLBHRLq7Kj9a2fTp/y","anim");i.exports=function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},e=i.getComponent(cc.Sprite),s=i.addComponent(cc.Animation),a=0;return t.forEach(function(i){cc.loader.loadResDir(i,cc.SpriteFrame,function(o,h){e.spriteFrame=h[0];var r=cc.AnimationClip.createWithSpriteFrames(h,8);r.name=i,r.wrapMode=cc.WrapMode.Loop,s.addClip(r),++a===t.length&&n()})}),s},cc._RF.pop()},{}],"frame-action":[function(t,i,n){"use strict";cc._RF.push(i,"75482+WGJtICoDc6STdwLjk","frame-action");var e=function(t){this.opts=t,this.node=t.parent,this.onPlay=t.onPlay,this.onFinished=t.onFinished,this.createAction(t)};e.prototype={createAction:function(t){var i=this,n=t.play,e=t.action,s=t.view,a=t.parent,o=new cc.Node;o.name="actions",o.parent=a;var h=o.addComponent(cc.Sprite),r=o.addComponent(cc.Animation);cc.loader.loadResDir(n+"/"+e+"/"+s,cc.SpriteFrame,function(t,n){var e=n;h.spriteFrame=e[0];var s=cc.AnimationClip.createWithSpriteFrames(e,8);s.name="anim_action",s.wrapMode=cc.WrapMode.Normal,r.addClip(s),r.play("anim_action"),r.on("play",i._onPlay,i),r.on("finished",i._onFinished,i)}),this.actionsNode=o},removeAniNode:function(){this.actionsNode.removeFromParent()},_onPlay:function(){console.log("_play"),this.onPlay&&this.onPlay()},_onFinished:function(){console.log("_onFinished"),this.removeAniNode(),this.onFinished&&this.onFinished()}},i.exports=e,cc._RF.pop()},{}],game:[function(t,i,n){"use strict";cc._RF.push(i,"c230fsafcFJlJ2OmgyMYqBy","game"),cc.Class({extends:cc.Component,properties:{ground:{default:null,type:cc.Node},hero:{default:null,type:cc.Node},punkPrefab:{default:null,type:cc.Prefab},scoreDisplay:{default:null,type:cc.Label},minX:0,maxX:0,minY:0,maxY:0,punkNodeList:[],score:0},onLoad:function(){this.getXYSpan(),this.newPunk(),this.newPunk()},getXYSpan:function(){var t=this.ground,i=t.height,n=t.y;this.minX=-cc.winSize.width/2,this.maxX=-this.minX,this.minY=n-i,this.maxY=n},newPunk:function(){var t=cc.instantiate(this.punkPrefab),i=this.getPunkPos();this.node.addChild(t),t.setPosition.apply(t,function(t){if(Array.isArray(t)){for(var i=0,n=Array(t.length);i<t.length;i++)n[i]=t[i];return n}return Array.from(t)}(i)),this.punkNodeList.push(t)},getPunkPos:function(){var t=Math.random();return[t>.5?this.minX:this.maxX,(this.maxY-this.minY)*t+this.minY]},heroAttack:function(){this.punkNodeList.forEach(function(t){t.getComponent("punk").getHit()})},punkFall:function(t){var i=this,n=this.punkNodeList.indexOf(t);-1!==n&&(this.punkNodeList.splice(n,1),setTimeout(function(){i.newPunk(),i.score++,i.scoreDisplay.string="score: "+i.score},1500))}}),cc._RF.pop()},{}],hero:[function(t,i,n){"use strict";cc._RF.push(i,"02842c1oZxJ3bu715Qv0lMl","hero");var e=t("./utils/anim.js");cc.Class({extends:cc.Component,properties:{parent:null,move:"",walking:!1,fisting:!1,kicking:!1,anim:null,face:"r",game:null,speedX:140,speedY:70,attackTimer:0},onLoad:function(){this.game=this.node.parent.getComponent("game"),this.node.zIndex=10,this.loadAnim(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},update:function(t){this.heroMove(t)},loadAnim:function(){var t=this;this.anim=e(["hero-fist","hero-kick","hero-walk"],this.node,function(){t.stand(),t.walking=!1,t.attackTimer=setInterval(function(){t.game.heroAttack(t,t.node)},500)})},heroMove:function(t){switch(this.move){case"":break;case"right":if(this.face="r",this.node.rotationY=0,this.node.x>=this.game.maxX)return;if(this.fisting||this.kicking)return;this.node.x+=this.speedX*t;break;case"left":if(this.face="l",this.node.rotationY=180,this.node.x<=this.game.minX)return;if(this.fisting||this.kicking)return;this.node.x-=this.speedX*t;break;case"up":if(this.node.y>=this.game.maxY)return;if(this.fisting||this.kicking)return;this.node.y+=this.speedY*t;break;case"down":if(this.node.y<=this.game.minY)return;if(this.fisting||this.kicking)return;this.node.y-=this.speedY*t}},onKeyDown:function(){switch(event.keyCode){case cc.macro.KEY.a:this.move="left",this.walk();break;case cc.macro.KEY.d:this.move="right",this.walk();break;case cc.macro.KEY.s:this.move="down",this.walk();break;case cc.macro.KEY.w:this.move="up",this.walk();break;case cc.macro.KEY.j:this.kick();break;case cc.macro.KEY.k:this.fist()}},onKeyUp:function(){switch(event.keyCode){case cc.macro.KEY.a:case cc.macro.KEY.d:case cc.macro.KEY.s:case cc.macro.KEY.w:this.move="",this.walking=!1,this.anim.stop("hero-walk");break;case cc.macro.KEY.j:this.kicking=!1,this.anim.stop("hero-kick"),this.stand();break;case cc.macro.KEY.k:this.fisting=!1,this.anim.stop("hero-fist"),this.stand()}},walk:function(){this.walking||this.fisting||this.kicking||(this.anim.play("hero-walk"),this.walking=!0)},kick:function(){this.kicking||(this.kicking=!0,this.anim.play("hero-kick"))},fist:function(){this.fisting||(this.fisting=!0,this.anim.play("hero-fist"))},stand:function(){var t=this;this.anim.play("hero-walk"),setTimeout(function(){t.anim.stop("hero-walk")},100)}}),cc._RF.pop()},{"./utils/anim.js":"anim"}],punk:[function(t,i,n){"use strict";var e;function s(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}cc._RF.push(i,"eaccbBWfHJG+YIWMvRWP1i4","punk");var a=t("./utils/anim.js");cc.Class({extends:cc.Component,properties:(e={ready:!1,radius:50,face:"r",head:"u",anim:null,speedX:50,speedY:25,heroNode:null,hero:null},s(e,"anim",null),s(e,"hurtTimer",0),s(e,"standing",!1),s(e,"walking",!1),s(e,"hurting",!1),s(e,"falling",!1),s(e,"ph",0),e),onLoad:function(){this.ph=5,this.speedX=50*Math.random()+30,this.standing=!1,this.walking=!1,this.hurting=!1,this.falling=!1,this.game=this.node.parent.getComponent("game"),this.heroNode=this.node.parent.getChildByName("hero"),this.hero=this.heroNode.getComponent("hero"),this.loadAnim()},update:function(t){this.approachHero(t)},loadAnim:function(){var t=this;this.anim=a(["punk-pant","punk-hurt","punk-fall","punk-walk"],this.node,function(){t.stand(),t.ready=!0})},getDist:function(){var t=this.node.x-this.heroNode.x,i=Math.abs(t),n=this.node.y-this.heroNode.y;return{deltaX:t,gapX:i,deltaY:n,gapY:Math.abs(n)}},approachHero:function(t){if(this.ready){var i=this.getDist(),n=i.deltaX,e=i.gapX,s=i.deltaY,a=i.gapY;this.head=s<0?"u":"d",this.node.zIndex="u"===this.head?this.heroNode.zIndex+1:this.heroNode.zIndex-1,this.hurting||this.falling||(this.face=n<0?"r":"l",this.node.rotationY="r"===this.face?0:180,this.walkingX(t,e),this.walkingY(t,e,a),e<50&&a<10?this.stand():this.walk())}},walkingX:function(t,i){if(!(i<50)){var n=i<this.speedX?i:this.speedX;"r"===this.face?this.node.x+=n*t:this.node.x-=n*t}},walkingY:function(t,i,n){if(!(i>150)){var e=n<this.speedY?n:this.speedY;"u"===this.head?this.node.y+=e*t:this.node.y-=e*t}},walk:function(){this.walking||(this.anim.play("punk-walk"),this.walking=!0)},stand:function(){var t=this;this.falling||(this.anim.play("punk-walk"),setTimeout(function(){t.anim.stop("punk-walk"),t.standing=!0,t.walking=!1},100))},getHit:function(){var t=this,i=this.getDist(),n=i.deltaX,e=i.gapX;i.gapY>20||e>60||this.falling||(this.hero.fisting||this.hero.kicking)&&("r"===this.hero.face&&n<0||"l"===this.hero.face&&n>0||(this.hurt(),this.hurtTimer&&clearTimeout(this.hurtTimer),this.hurtTimer=setTimeout(function(){t.stand(),t.ph=5,t.hurting=!1},2e3)))},hurt:function(){var t=this;this.anim.play("punk-hurt"),setTimeout(function(){t.anim.pause("punk-hurt")},200),this.hurting=!0,this.ph--,this.ph<=0&&this.fall()},fall:function(){var t=this;this.hurtTimer&&clearTimeout(this.hurtTimer),this.anim.play("punk-fall"),this.game.punkFall(this.node),setTimeout(function(){t.node.destroy()},2e3),this.falling=!0}}),cc._RF.pop()},{"./utils/anim.js":"anim"}]},{},["game","hero","punk","anim","frame-action"]);